<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Human Skeletal System</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#0b63ff;--muted:#6b7280}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{background:var(--bg);display:flex;align-items:stretch}
    .container{display:grid;grid-template-columns:1fr 360px;gap:20px;padding:28px;width:100%}
    .viewer{background:linear-gradient(180deg,#ffffff 0%, #eef3fb 100%);border-radius:12px;box-shadow:0 6px 24px rgba(12,38,78,0.08);min-height:78vh;position:relative;overflow:hidden}
    canvas{width:100%;height:100%;display:block}
    header{display:flex;align-items:center;gap:12px;padding:20px}
    h1{font-size:18px;margin:0}
    .author{font-size:12px;color:var(--muted)}
    .panel{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(12,38,78,0.06);height:78vh;overflow:auto}
    .info-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .bone-name{font-weight:600;font-size:16px}
    .bone-func{color:var(--muted);margin-top:8px}
    .fun-fact{margin-top:12px;background:#f1f5ff;padding:10px;border-radius:8px;font-size:13px}
    .list{margin-top:14px}
    .list input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef9}
    .bone-list{margin-top:10px}
    .bone-item{padding:8px;border-radius:8px;cursor:pointer;border:1px solid transparent}
    .bone-item:hover{background:#fbfdff;border-color:#eef4ff}
    footer{font-size:12px;color:var(--muted);margin-top:14px}
    .controls{position:absolute;left:18px;top:18px;background:rgba(255,255,255,0.9);backdrop-filter:blur(6px);padding:8px;border-radius:10px;border:1px solid #eef3fb}
    .small{font-size:12px;color:var(--muted)}
    @media(max-width:980px){.container{grid-template-columns:1fr;}.panel{height:auto;margin-top:14px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="viewer" id="viewer">
      <div class="controls">
        <div class="small">Drag to rotate • Scroll to zoom • Tap to select</div>
      </div>
      <header style="position:absolute;right:18px;top:18px;z-index:8;">
        <div style="text-align:right">
          <h1>The Human Skeletal System</h1>
          <div class="author">Jian Audrey Marie D. Cabebe — BSTM 1A — PATHFIT 1</div>
        </div>
      </header>
      <canvas id="c"></canvas>
    </div>

    <aside class="panel">
      <div class="info-title">
        <div>
          <div class="bone-name" id="boneName">Click a bone to learn</div>
          <div class="bone-func" id="boneFunc">Explore the skeleton by rotating, zooming, and tapping bones.</div>
        </div>
        <div style="text-align:right"><div style="font-size:12px;color:var(--muted)">Educational • PE-friendly</div></div>
      </div>

      <div class="fun-fact" id="boneFact">Fun facts will appear here when you select a bone.</div>

      <div class="list">
        <input type="text" id="search" placeholder="Search bone name..." />
        <div class="bone-list" id="boneList"></div>
      </div>

      <footer>
        Source: public GLB hosted on GitHub (DavidVeksler/CheatSheets). If you prefer to use your own model, replace the MODEL_URL constant in the script with a local <code>models/skeleton.glb</code> path.<br>
        License & credits: please review the model's license before public use.
      </footer>
    </aside>
  </div>

  <script type="module">
    import * as THREE from 'https://unpkg.com/three@0.155.0/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.155.0/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://unpkg.com/three@0.155.0/examples/jsm/loaders/GLTFLoader.js';

    const MODEL_URL = 'https://raw.githubusercontent.com/DavidVeksler/CheatSheets/main/human_skeleton.glb';

    const canvas = document.getElementById('c');
    const scene = new THREE.Scene();
    const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:true});
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(canvas.clientWidth || 800, canvas.clientHeight || 600, false);

    const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
    camera.position.set(0, 1.4, 3);

    const light = new THREE.HemisphereLight(0xffffff, 0x777788, 1.0);
    scene.add(light);
    const dir = new THREE.DirectionalLight(0xffffff, 0.8);
    dir.position.set(5,10,7);
    scene.add(dir);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0,1,0);
    controls.enableDamping = true;
    controls.dampingFactor = 0.08;

    const grid = new THREE.GridHelper(10, 20, 0xeeeeee,0xeeeeee);
    grid.material.opacity = 0.0; grid.material.transparent=true; scene.add(grid);

    const raycaster = new THREE.Raycaster();
    const pointer = new THREE.Vector2();
    let highlighted = null;

    const boneInfo = {
      "Skull":{display:"Skull (Cranium)", function:"Protects the brain; supports facial structures.", fact:"The adult skull is made of 22 bones joined together."},
      "Mandible":{display:"Mandible (Lower jaw)", function:"Houses lower teeth and enables chewing and speech.", fact:"The mandible is the only moveable skull bone in adults."},
      "Clavicle":{display:"Clavicle (Collarbone)", function:"Connects the arm to the trunk and helps stabilize the shoulder.", fact:"Clavicle is the most commonly fractured bone in children and adults."},
      "Scapula":{display:"Scapula (Shoulder blade)", function:"Provides attachment for shoulder muscles and supports arm movement.", fact:"The scapula floats on the back of the ribcage and is held by muscles."},
      "Sternum":{display:"Sternum (Breastbone)", function:"Protects the heart and lungs and anchors the ribs via costal cartilages.", fact:"The sternum has three parts: manubrium, body, and xiphoid process."},
      "Rib":{display:"Rib (One of 24)", function:"Protects thoracic organs and assists breathing by moving with the lungs.", fact:"Most humans have 12 pairs of ribs, but variations exist."},
      "Vertebra":{display:"Vertebra (Individual backbone bone)", function:"Protects the spinal cord and supports the body’s weight.", fact:"There are normally 33 vertebrae in total (including fused sacrum & coccyx)."},
      "Cervical":{display:"Cervical vertebrae (Neck)", function:"Support the head and allow neck movement.", fact:"The first cervical vertebra (atlas) supports the skull; the second (axis) enables head rotation."},
      "Thoracic":{display:"Thoracic vertebrae (Upper back)", function:"Anchor the ribs and support the thoracic cage.", fact:"Thoracic vertebrae have facets for rib articulation."},
      "Lumbar":{display:"Lumbar vertebrae (Lower back)", function:"Bear most of the body’s weight and allow flexion/extension.", fact:"Lumbar vertebrae are larger than cervical and thoracic vertebrae."},
      "Sacrum":{display:"Sacrum", function:"Connects the spine to the pelvis and transfers weight to the legs.", fact:"The sacrum is formed from five fused vertebrae."},
      "Coccyx":{display:"Coccyx (Tailbone)", function:"Provides attachment for ligaments and small muscles.", fact:"The coccyx is usually made of 3–5 fused vertebrae."},
      "Humerus":{display:"Humerus (Upper arm)", function:"Main bone of the upper arm; articulates with scapula and forearm.", fact:"The humerus head fits into the glenoid cavity of the scapula forming the shoulder joint."},
      "Radius":{display:"Radius (Forearm)", function:"Larger near the wrist; allows rotation of the forearm (supination/pronation).", fact:"The radius crosses over the ulna when you rotate your palm downward."},
      "Ulna":{display:"Ulna (Forearm)", function:"Forms the elbow joint with the humerus; stabilizes forearm.", fact:"The olecranon process of the ulna creates the bony point of the elbow."},
      "Carpal":{display:"Carpal bones (Wrist)", function:"Small bones that enable wrist motion and hand flexibility.", fact:"There are 8 carpal bones arranged in two rows."},
      "Metacarpal":{display:"Metacarpals (Hand bones)", function:"Form the palm and support finger movement.", fact:"Each finger has one metacarpal; the thumb's metacarpal is more mobile."},
      "Phalanges_hand":{display:"Phalanges (Fingers)", function:"Bones of the fingers; enable fine manipulation.", fact:"Fingers have 14 phalanges in each hand (3 per finger, 2 in the thumb)."},
      "Pelvis":{display:"Pelvis (Hip bones)", function:"Support abdominal organs and transfer weight to the legs; anchors muscles.", fact:"The pelvis consists of ilium, ischium, and pubis (fused in adults)."},
      "Femur":{display:"Femur (Thigh bone)", function:"Strongest and longest bone; supports body weight during standing/walking.", fact:"The femur can support up to 30 times body weight in healthy adults."},
      "Patella":{display:"Patella (Kneecap)", function:"Protects the knee joint and improves leverage of the thigh muscles.", fact:"The patella develops in the tendon of the quadriceps muscle (a sesamoid bone)."},
      "Tibia":{display:"Tibia (Shin bone)", function:"Main weight-bearing bone of the lower leg.", fact:"The tibia is the second largest bone in the human skeleton after the femur."},
      "Fibula":{display:"Fibula (Calf bone)", function:"Stabilizes the ankle and provides muscle attachment; not weight-bearing.", fact:"The fibula is slender and lies lateral to the tibia."},
      "Tarsal":{display:"Tarsal bones (Ankle)", function:"Form the ankle and posterior foot; help bear weight and provide leverage.", fact:"There are 7 tarsal bones including the talus and calcaneus (heel)."},
      "Metatarsal":{display:"Metatarsals (Foot)", function:"Form the arch and support stepping and balance.", fact:"Metatarsals are analogous to metacarpals in the hand."},
      "Phalanges_foot":{display:"Phalanges (Toes)", function:"Bones of the toes; help maintain balance during walking.", fact:"Toes have 14 phalanges in each foot (similar arrangement to fingers)."}
    };

    const boneListEl = document.getElementById('boneList');
    const boneNames = Object.keys(boneInfo);
    boneNames.forEach(key=>{
      const item = document.createElement('div');
      item.className = 'bone-item';
      item.textContent = boneInfo[key].display;
      item.onclick = ()=> showBoneInfo(key);
      boneListEl.appendChild(item);
    });

    function showBoneInfo(key){
      const data = boneInfo[key];
      document.getElementById('boneName').textContent = data.display;
      document.getElementById('boneFunc').textContent = data.function;
      document.getElementById('boneFact').textContent = data.fact;
      highlightMeshByName(key);
    }

    function highlightMeshByName(name){
      if(!scene) return;
      let found = null;
      scene.traverse(obj=>{
        if(!found && obj.isMesh){
          const n = (obj.name||'').toLowerCase();
          if(n.includes(name.toLowerCase()) || n.includes((boneInfo[name].display||'').toLowerCase().split(' ')[0])){
            found = obj;
          }
        }
      });
      if(found) pickObject(found);
    }

    function pickObject(obj){
      if(highlighted && highlighted !== obj){
        if(highlighted.userData.origColor) try{ highlighted.material.color.set(highlighted.userData.origColor); }catch(e){}
      }
      highlighted = obj;
      if(obj.userData.origColor === undefined){
        try{ obj.userData.origColor = obj.material.color.getHexString(); } catch(e){ obj.userData.origColor = null; }
      }
      try{ obj.material.color.set('#f59e0b'); } catch(e){}
      const box = new THREE.Box3().setFromObject(obj);
      const center = box.getCenter(new THREE.Vector3());
      controls.target.copy(center);
      const size = box.getSize(new THREE.Vector3()).length();
      const distance = Math.max(size*2.2, 1.2);
      camera.position.copy(center.clone().add(new THREE.Vector3(distance, distance*0.6, distance)));
    }

    const loader = new GLTFLoader();
    loader.load(MODEL_URL, gltf=>{
      const model = gltf.scene || gltf.scenes[0];
      model.position.set(0,0,0);
      model.scale.setScalar(1.0);
      scene.add(model);
      const box = new THREE.Box3().setFromObject(model);
      const size = box.getSize(new THREE.Vector3());
      const maxDim = Math.max(size.x, size.y, size.z);
      const scale = 1.2 / maxDim;
      model.scale.setScalar(scale);
      box.setFromObject(model);
      const center = box.getCenter(new THREE.Vector3());
      model.position.sub(center);
      animate();
    }, xhr=>{}, err=>{console.error('Model load error:',err); alert('Failed to load model. If you are offline the model might not load.');});

    function onPointer(e){
      const rect = renderer.domElement.getBoundingClientRect();
      pointer.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
      pointer.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
      raycaster.setFromCamera(pointer, camera);
      const intersects = raycaster.intersectObjects(scene.children, true);
      if(intersects.length){
        const picked = intersects[0].object;
        const meshName = (picked.name||'').toLowerCase();
        let matchedKey = null;
        for(const key of boneNames){
          const d = boneInfo[key];
          const searchTerms = [key.toLowerCase(), (d.display||'').toLowerCase().split(' ')[0]];
          if(searchTerms.some(t=> t && meshName.includes(t))){ matchedKey = key; break; }
        }
        if(matchedKey){ showBoneInfo(matchedKey); }
        else{
          document.getElementById('boneName').textContent = picked.name || 'Unknown part';
          document.getElementById('boneFunc').textContent = 'No preloaded info for this mesh. Use the side list to explore named bones.';
          document.getElementById('boneFact').textContent = 'Mesh name: ' + (picked.name||'unnamed');
          pickObject(picked);
        }
      }
    }

    renderer.domElement.addEventListener('click', onPointer);

    function onWindowResize(){
      const width = document.getElementById('viewer').clientWidth;
      const height = document.getElementById('viewer').clientHeight;
      camera.aspect = width/height;
      camera.updateProjectionMatrix();
      renderer.setSize(width, height, false);
    }
    window.addEventListener('resize', onWindowResize);

    function animate(){
      controls.update();
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }

    onWindowResize();

    document.getElementById('search').addEventListener('input', e=>{
      const q = e.target.value.toLowerCase();
      boneListEl.childNodes.forEach((node, i)=>{
        const text = node.textContent.toLowerCase();
        node.style.display = text.includes(q) ? 'block' : 'none';
      });
    });

  </script>
</body>
</html>
